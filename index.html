<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Essentials Hub</title>
<style>
:root{
  --bg1:#0d111b; --bg2:#0b1526; --card:#0f1724;
  --text:#e5e7eb; --muted:#9ca3af; --accent:#6366f1; --accent2:#4cc1ff;
  --radius:12px; font-family:Inter, system-ui, sans-serif;
}
*{box-sizing:border-box}
html,body{height:100%}
body{ margin:0; padding:0;
  background:
    radial-gradient(900px 600px at 80% 10%, rgba(76,193,255,0.06), transparent),
    linear-gradient(180deg, var(--bg1), var(--bg2));
  color:var(--text); -webkit-font-smoothing:antialiased;
}
header{
  background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  backdrop-filter:blur(8px); color:var(--text);
  text-align:center; padding:20px; font-size:26px; font-weight:700;
  border-bottom:1px solid rgba(255,255,255,0.04);
}
.tagline{ text-align:center; font-size:13px; color:var(--muted); margin-top:6px; }
section{ padding:20px; max-width:980px; margin:22px auto; }
h2{ color:var(--accent2); border-left:4px solid var(--accent2); padding-left:10px; }

.pricing-table, .order-box{
  background:var(--card); padding:16px; border-radius:var(--radius);
  box-shadow:0 8px 24px rgba(0,0,0,0.45);
  border:1px solid rgba(255,255,255,0.04); margin-bottom:16px;
  transition:box-shadow .22s ease, transform .18s ease, border-color .18s ease;
}
.pricing-table:hover, .order-box:hover{
  box-shadow:
    0 12px 40px rgba(0,0,0,0.55),
    0 0 40px rgba(76,193,255,0.06);
  border-color: rgba(76,193,255,0.12);
  transform: translateY(-4px);
}

label{ display:block; font-weight:700; color:var(--text); margin-top:10px; }
input[type="number"], select, textarea, input[type="text"]{
  width:100%; padding:10px; margin-top:8px; margin-bottom:12px;
  background:rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.06);
  color:var(--text); border-radius:8px; outline:none;
  transition: box-shadow .18s ease, border-color .18s ease, transform .12s ease;
}
input[type="number"]:focus, select:focus, textarea:focus, input[type="text"]:focus{
  box-shadow: 0 6px 18px rgba(76,193,255,0.06), 0 0 8px rgba(76,193,255,0.08) inset;
  border-color: rgba(76,193,255,0.28);
  transform: translateY(-1px);
}

.row-inline{ display:flex; align-items:center; gap:12px; flex-wrap:wrap; }
.row-inline > div{ display:flex; align-items:center; gap:8px; padding:6px 8px; border-radius:8px; transition: background .12s ease, box-shadow .12s ease; }
.row-inline > div:hover{
  background: linear-gradient(90deg, rgba(76,193,255,0.03), rgba(99,102,241,0.02));
  box-shadow: 0 6px 18px rgba(76,193,255,0.04);
}

/* glow hover for buttons & boxes */
.pricing-table:hover, .order-box:hover { box-shadow: 0 12px 40px rgba(0,0,0,0.55), 0 0 40px rgba(76,193,255,0.08); }
.btn-primary:hover{ box-shadow: 0 18px 50px rgba(99,102,241,0.22), 0 0 48px rgba(76,193,255,0.18); }
.btn-ghost:hover{ box-shadow: 0 12px 30px rgba(0,0,0,0.35), 0 0 20px rgba(76,193,255,0.06); }
.row-inline > div:hover { box-shadow: 0 8px 26px rgba(76,193,255,0.05); }

.small-note{ font-size:13px; color:var(--muted); margin-top:4px; margin-bottom:8px; }

button{ display:inline-block; padding:10px 14px; border-radius:10px; border:0; cursor:pointer; font-weight:800; transition: transform .14s ease, box-shadow .18s ease, opacity .12s ease; }
.btn-primary{
  background: linear-gradient(90deg, var(--accent), #5f7bff); color:#fff;
  box-shadow:0 8px 24px rgba(99,102,241,0.18);
  border: 1px solid rgba(99,102,241,0.12);
}
.btn-primary:hover{ transform: translateY(-4px); opacity:0.98; }
.btn-ghost{ background:transparent; color:var(--text); border:1px solid rgba(255,255,255,0.04); padding:9px 12px; border-radius:10px; }

.total-row{ display:flex; gap:12px; align-items:center; margin-top:8px; }
.total-row .label{ color:var(--muted); font-weight:600; }
.total-amount{ font-size:1.2rem; font-weight:800; color:var(--text); }

.error-banner{ background:#2b0a0a; color:#ffd6d6; padding:10px; border-radius:8px; margin-bottom:12px; display:none; }

.table-grid{ display:grid; grid-template-columns:1fr; gap:8px; }
@media(min-width:880px){ .table-grid{ grid-template-columns:repeat(2,1fr); } }
@media (max-width:720px){ .row-inline{ flex-direction:column; align-items:flex-start } }

footer{ text-align:center; padding:16px; color:var(--muted); margin-top:18px; border-top:1px solid rgba(255,255,255,0.04); }
.small-muted{ font-size:12px; color:var(--muted); margin-top:6px; }
</style>
</head>
<body>
<header>✨Essentials Hub✨</header>
<p class="tagline">Printing, Coding, Project Kits & Assignment Help — fast, affordable, student-friendly.</p>

<section>
  <div id="errorBanner" class="error-banner" role="alert"></div>

  <div class="pricing-table">
    <h2>Pricing (Complete list with short descriptions)</h2>
    <div class="table-grid">
    <div>
  <h3>Lab Manuals</h3>

  <p>
    <strong>Maths Lab Manual: ₹95</strong><br>
    <span class="small-note">
      Complete mathematics lab manual as per college syllabus (PDF / print-ready).
    </span>
  </p>
</div>
      <div>
        <h3>Printing & Binding</h3>
        <p><strong>B/W Print (Single): ₹3/page</strong><br><span class="small-note">Standard single-sided black & white printing (min 6 pages).</span></p>
        <p><strong>B/W Print (Double): ₹4/sheet</strong><br><span class="small-note">Double-sided economical printing (min 6 sheets).</span></p>
        <p><strong>Color Print: ₹10/page</strong><br><span class="small-note">Full-color pages for reports, posters or images.</span></p>
        <p><strong>Poster Printing: ₹20/page</strong><br><span class="small-note">Large-format poster prints (A3+ style).</span></p>
        <p><strong>Spiral Binding (add-on): ₹20</strong><br><span class="small-note">Neat spiral binding for reports and notes (flat add-on).</span></p>
        <p><strong>Folder / Cover: ₹30</strong><br><span class="small-note">Cardboard soft cover for project submissions.</span></p>
      </div>

      <div>
        <h3>Digital & Small Services</h3>
        <p><strong>Resume / CV Design: ₹150</strong><br><span class="small-note">Formatted, professional resume in Word & PDF.</span></p>
        <p><strong>Notes PDF (digital): ₹30</strong><br><span class="small-note">Well-formatted notes in PDF (per topic/file).</span></p>
        <p><strong>USB Transfer: ₹50</strong><br><span class="small-note">Copy files to USB / collect files from USB.</span></p>
      </div>

      <div>
        <h3>Design & Media</h3>
        <p><strong>Social Post Design: ₹200</strong><br><span class="small-note">Instagram/Facebook post design (1 design).</span></p>
        <p><strong>Logo Design: ₹500</strong><br><span class="small-note">Simple logo concepts and 1 round of revision.</span></p>
        <p><strong>Project Explanation Video: ₹1000</strong><br><span class="small-note">Short recorded explanation/demo video for projects.</span></p>
        <p><strong>Civil Drawing (PDF): ₹200</strong><br><span class="small-note">Academic civil engineering drawings for project and submission use.</span></p>
      </div>

      <div>
        <h3>Coding & Project Kits</h3>
        <p><strong>Quick Fix: ₹30–₹50</strong><br><span class="small-note">Small bug fixes or debugging help.</span></p>
        <p><strong>30-Min Guidance: ₹50</strong><br><span class="small-note">Short mentoring session (30 minutes).</span></p>
        <p><strong>1 Hour Coding Support: ₹100</strong><br><span class="small-note">Hands-on coding help / tutoring.</span></p>
        <p><strong>Code Cleanup: ₹50–₹150</strong><br><span class="small-note">Refactor & comment code for clarity.</span></p>
        <p><strong>Mini Project: ₹200–₹300</strong><br><span class="small-note">Small project deliverable with code + report.</span></p>
        <p><strong>Intermediate Project: ₹400–₹600</strong></p>
        <p><strong>Full Bundle: ₹800–₹1200</strong><br><span class="small-note">Complete package: code, PPT and report.</span></p>
      </div>

      <div>
        <h3>Assignment & Support</h3>
        <p><strong>Report Typing: ₹80–₹150</strong><br><span class="small-note">Typing long reports, formatting, headers/TOC.</span></p>
        <p><strong>PPT Creation: ₹50–₹100</strong><br><span class="small-note">Slide deck from notes or report.</span></p>
        <p><strong>Assignment Formatting: ₹20–₹50</strong><br><span class="small-note">Formatting to college template.</span></p>
        <p><strong>PDF Conversion: ₹10</strong><br><span class="small-note">Word → PDF / Scanned images → PDF.</span></p>
        <p><strong>Scanning: ₹5/page</strong><br><span class="small-note">High-quality scanned pages.</span></p>
        <p><strong>Data Entry / Excel Work: ₹200/hour</strong><br><span class="small-note">Data cleaning, sheet preparation.</span></p>
        <p><strong>Form Filling / College Forms: ₹100</strong><br><span class="small-note">Help filling application forms correctly.</span></p>
        <p><strong>MCQ / Small Assignment Help: ₹100</strong><br><span class="small-note">Solution assistance for small assignment pieces (tutoring style).</span></p>
        <p class="small-muted">Delivery fees: Printing orders — ₹5 (free if pages ≥ 20). Flat services — ₹15 (always paid).</p>
      </div>
    </div>
  </div>

  <div class="order-box">
    <h2>Order Now - Select Your Options</h2>

    <label for="service">Select Service</label>
    <select id="service" aria-label="service">
      <option value="">Choose...</option>
      <!-- Lab Manuaks -->
      <option value="maths_manual" data-type="flat" data-min="95" data-max="95">
  Maths Lab Manual — ₹95
</option>
      <!-- Printing -->
      <option value="bw_single" data-type="per_page" data-min="3" data-max="3" data-min-qty="6">B/W Print (Single) — ₹3/page</option>
      <option value="bw_double" data-type="per_page" data-min="4" data-max="4" data-min-qty="6">B/W Print (Double) — ₹4/sheet</option>
      <option value="color_print" data-type="per_page" data-min="10" data-max="10">Color Print — ₹10/page</option>
      <option value="poster_print" data-type="per_page" data-min="20" data-max="20">Poster Printing — ₹20/page</option>
     
      <!-- Digital / Design -->
      <option value="civil_drawing" data-type="flat" data-min="200" data-max="200">Civil Drawing (PDF) — ₹200</option>
      <option value="notes_pdf" data-type="flat" data-min="30" data-max="30">Notes PDF (digital) — ₹30</option>
      <option value="resume" data-type="flat" data-min="150" data-max="150">Resume / CV Design — ₹150</option>
      <option value="social_post" data-type="flat" data-min="200" data-max="200">Social Post Design — ₹200</option>
      <option value="logo_design" data-type="flat" data-min="500" data-max="500">Logo Design — ₹500</option>
      <option value="video_explain" data-type="flat" data-min="1000" data-max="1000">Project Explanation Video — ₹1000</option>
      <option value="usb_transfer" data-type="flat" data-min="50" data-max="50">USB Transfer — ₹50</option>

      <!-- Printing extras / finishes -->
      <option value="lamination" data-type="flat" data-min="20" data-max="20">Lamination — ₹20</option>

      <!-- Formatting / Scanning -->
      <option value="formatting_print" data-type="per_page" data-min="20" data-max="50">Formatting — ₹20–₹50/page</option>
      <option value="report_typing" data-type="per_page" data-min="80" data-max="150">Report Typing — ₹80–₹150/page</option>
      <option value="ppt" data-type="flat" data-min="50" data-max="100">PPT Creation — ₹50–₹100</option>
      <option value="scanning_print" data-type="per_page" data-min="5" data-max="5">Scanning — ₹5/page</option>

      <!-- Coding Help -->
      <option value="quick_fix" data-type="flat" data-min="30" data-max="50">Quick Fix — ₹30–₹50</option>
      <option value="guidance_30" data-type="flat" data-min="50" data-max="50">30-Min Guidance — ₹50</option>
      <option value="coding_1hr" data-type="flat" data-min="100" data-max="100">1 Hour Coding Support — ₹100</option>
      <option value="code_cleanup" data-type="flat" data-min="50" data-max="150">Code Cleanup — ₹50–₹150</option>

      <!-- Project Kits -->
      <option value="mini_project" data-type="flat" data-min="200" data-max="300">Mini Project — ₹200–₹300</option>
      <option value="intermediate_project" data-type="flat" data-min="400" data-max="600">Intermediate Project — ₹400–₹600</option>
      <option value="full_bundle" data-type="flat" data-min="800" data-max="1200">Full Bundle — ₹800–₹1200</option>

      <!-- Assignment Support & others -->
      <option value="assign_formatting" data-type="per_page" data-min="20" data-max="50">Assignment Formatting — ₹20–₹50</option>
      <option value="pdf_conversion" data-type="flat" data-min="10" data-max="10">PDF Conversion — ₹10</option>
      <option value="assign_scanning" data-type="per_page" data-min="5" data-max="5">Assignment Scanning — ₹5/page</option>
      <option value="data_entry" data-type="flat" data-min="200" data-max="200">Data Entry / Excel — ₹200/hour</option>
      <option value="form_filling" data-type="flat" data-min="100" data-max="100">Form Filling — ₹100</option>
      <option value="mcq_help" data-type="flat" data-min="100" data-max="100">MCQ / Small Assignment Help — ₹100</option>
    </select>

    <label for="quantity">Quantity / Pages / Hours</label>
    <input id="quantity" type="number" min="1" value="1" />

    <!-- Extras: Spiral, File/Folder and Delivery (checkboxes) -->
    <div class="row-inline" style="margin-top:8px;">
      <div>
        <input id="addSpiral" type="checkbox" style="width:18px;height:18px;cursor:pointer;">
        <label for="addSpiral" style="margin:0;cursor:pointer;">Add Spiral Binding (₹20)</label>
      </div>

      <div>
        <input id="addFolder" type="checkbox" style="width:18px;height:18px;cursor:pointer;">
        <label for="addFolder" style="margin:0;cursor:pointer;">Add File / Folder (₹30)</label>
      </div>

      <div>
        <input id="addDelivery" type="checkbox" style="width:18px;height:18px;cursor:pointer;">
        <label for="addDelivery" style="margin:0;cursor:pointer;">On-Campus Delivery (Printing fee ₹5 — FREE if pages ≥ 20; Flat services ₹15)</label>
      </div>
    </div>
    <p class="small-note" id="extras-note">Check delivery, then type your college name below (required if requesting delivery).</p>

    <!-- College text input (shown only when delivery checkbox checked) -->
    <div id="collegeBlock" style="display:none; margin-top:8px;">
      <label for="collegeName">Type your college name</label>
      <input id="collegeName" type="text" placeholder="e.g., Government Polytechnic Ahmedabad" />
      <div class="small-note">College name is required for on-campus delivery.</div>
    </div>

    <label for="notes">Additional Notes</label>
    <textarea id="notes" rows="3" placeholder="Optional — e.g., Python, Java, A4, double-sided, etc."></textarea>

    <div class="total-row" role="status" aria-live="polite">
      <div class="label">Estimated total:</div>
      <div class="total-amount">₹<span id="total">0</span></div>
    </div>

    <div style="display:flex; gap:8px; margin-top:12px; flex-wrap:wrap;">
      <button id="calcBtn" class="btn-primary">Order via WhatsApp</button>
      <button id="downloadInvoice" class="btn-ghost">Download Invoice</button>
    </div>

    <p class="small-note" id="order-id-note" style="margin-top:8px;"></p>
  </div>

  <h2>Contact Us</h2>
  <p class="small-note"><b>Phone:</b> +91 99786 51150 | +91 91040 63798 | +91 85113 67564 — For direct orders: WhatsApp us.</p>
</section>

<footer>© <span id="year"></span> Essentials Hub</footer>

<script>
(() => {
  // elements
  const serviceEl = document.getElementById('service');
  const qtyEl = document.getElementById('quantity');
  const totalEl = document.getElementById('total');
  const notesEl = document.getElementById('notes');
  const calcBtn = document.getElementById('calcBtn');
  const waBtn = document.getElementById('waOrder');
  const spiralBox = document.getElementById('addSpiral');
  const folderBox = document.getElementById('addFolder');
  const deliveryBox = document.getElementById('addDelivery');
  const downloadBtn = document.getElementById('downloadInvoice');
  const orderIdNote = document.getElementById('order-id-note');
  const errorBanner = document.getElementById('errorBanner');
  const collegeBlock = document.getElementById('collegeBlock');
  const collegeNameInput = document.getElementById('collegeName');
  const yearEl = document.getElementById('year');
  if(yearEl) yearEl.textContent = new Date().getFullYear();

  // fees & rules
  const PRINT_DELIVERY_FEE = 5;   // printing delivery when not free
  const FLAT_DELIVERY_FEE = 15;   // flat services delivery default
  const FREE_PRINT_THRESHOLD = 20; // printing pages >= this => delivery free

  function safeNumber(x, fallback=0){
    const n = Number(x);
    return (isFinite(n) ? n : fallback);
  }
  function formatINR(n){ return safeNumber(n).toLocaleString('en-IN'); }
  function generateOrderId(){ return 'EH' + Date.now().toString().slice(-8); }
  function getSelectedOption(){ try { return serviceEl && serviceEl.selectedOptions && serviceEl.selectedOptions[0]; } catch(e){ return null; } }
  function isPrintingService(opt){ if(!opt) return false; return String(opt.dataset.type || opt.getAttribute('data-type') || '').toLowerCase() === 'per_page'; }

  function showError(msg){
    if(!errorBanner) return;
    errorBanner.textContent = msg;
    errorBanner.style.display = 'block';
    setTimeout(()=>{ errorBanner.style.display = 'none'; }, 5000);
  }
  function clearError(){ if(errorBanner) errorBanner.style.display = 'none'; }

  // enable/disable extras depending on selected service
  function updateExtrasAvailability(){
    const opt = getSelectedOption();
    const printing = isPrintingService(opt);
    if(spiralBox){ spiralBox.disabled = !printing; if(!printing) spiralBox.checked = false; }
    if(folderBox){ folderBox.disabled = !printing; if(!printing) folderBox.checked = false; }
    const note = document.getElementById('extras-note');
    if(note) note.style.opacity = printing ? '1' : '0.95';
  }

  // show/hide college input when delivery checked
  function updateCollegeBlock(){
    if(deliveryBox && deliveryBox.checked){
      collegeBlock.style.display = 'block';
    } else {
      collegeBlock.style.display = 'none';
      if(collegeNameInput) collegeNameInput.value = '';
    }
  }

  // get typed college name (trim)
  function getEnteredCollege(){
    if(!collegeNameInput) return '';
    return (collegeNameInput.value || '').trim();
  }

  // calculate totals and delivery fee logic
  function calculate(){
    try{
      clearError();
      const opt = getSelectedOption();
      if(!opt || !opt.value) return {min:0,max:0,violatesMinQty:false,deliveryFee:0,freeDelivery:false};

      const dmin = opt.dataset.min ?? opt.getAttribute('data-min') ?? '0';
      const dmax = opt.dataset.max ?? opt.getAttribute('data-max') ?? dmin;
      const min = Math.max(0, safeNumber(String(dmin).replace(/[^0-9.-]/g,''), 0));
      const max = Math.max(min, safeNumber(String(dmax).replace(/[^0-9.-]/g,''), min));
      const type = (opt.dataset.type || opt.getAttribute('data-type') || 'flat').toString();

      let qty = 1;
      if(qtyEl){
        qty = safeNumber(qtyEl.value, 1);
        if(qty < 1) qty = 1;
        if(type === 'per_page') qty = Math.floor(qty);
      }

      // min-qty enforcement
      const rawMinQty = opt.dataset.minQty ?? opt.getAttribute('data-min-qty') ?? opt.dataset.minqty ?? opt.getAttribute('data-minqty');
      const minQty = (rawMinQty !== undefined && rawMinQty !== null) ? Math.max(1, Math.floor(safeNumber(rawMinQty,1))) : 1;
      if(qty < minQty){
        return {min:0, max:0, violatesMinQty:true, minQtyRequired:minQty, deliveryFee:0, freeDelivery:false};
      }

      let minTotal = (type === 'per_page') ? min * qty : min * qty;
      let maxTotal = (type === 'per_page') ? max * qty : max * qty;

      // extras
      if(spiralBox && spiralBox.checked){ minTotal += 20; maxTotal += 20; }
      if(folderBox && folderBox.checked){ minTotal += 30; maxTotal += 30; }

      // delivery logic:
      // if delivery box not checked => deliveryFee 0
      // if checked:
      // - printing service: free if qty >= FREE_PRINT_THRESHOLD, else PRINT_DELIVERY_FEE
      // - flat service: always FLAT_DELIVERY_FEE
      let deliveryFee = 0;
      let freeDelivery = false;
      if(deliveryBox && deliveryBox.checked){
        const printing = isPrintingService(opt);
        if(printing){
          if(qty >= FREE_PRINT_THRESHOLD){
            deliveryFee = 0;
            freeDelivery = true;
          } else {
            deliveryFee = PRINT_DELIVERY_FEE;
          }
        } else {
          deliveryFee = FLAT_DELIVERY_FEE;
        }
      }

      minTotal += deliveryFee;
      maxTotal += deliveryFee;

      minTotal = safeNumber(minTotal, 0);
      maxTotal = safeNumber(maxTotal, minTotal);

      return {min:minTotal, max:maxTotal, violatesMinQty:false, deliveryFee, freeDelivery};
    } catch(err){
      console.error('Calculation error', err);
      showError('An unexpected error occurred while calculating. Try reloading the page.');
      return {min:0,max:0,violatesMinQty:false,deliveryFee:0,freeDelivery:false};
    }
  }

  function setEstimatedLabel(text){
    const orderBox = document.querySelector('.order-box');
    if(!orderBox) return;
    const label = orderBox.querySelector('.total-row .label');
    if(label) label.textContent = text;
  }

  function displayTotal(){
    updateExtrasAvailability();
    updateCollegeBlock();
    const t = calculate();
    if(t.violatesMinQty){
      if(totalEl) totalEl.textContent = '0';
      setEstimatedLabel(`Estimated total: (min ${t.minQtyRequired} pages required)`);
      if(orderIdNote) orderIdNote.textContent = '';
      return t;
    } else {
      setEstimatedLabel('Estimated total:');
    }
    if(totalEl){
      totalEl.textContent = (t.min === t.max) ? formatINR(t.min) : `${formatINR(t.min)} – ${formatINR(t.max)}`;
    }
    if(orderIdNote) orderIdNote.textContent = `Order ID: ${generateOrderId()}`;
    return t;
  }

  // events
  if(calcBtn) calcBtn.addEventListener('click', e => { e.preventDefault(); displayTotal(); });
  if(serviceEl) serviceEl.addEventListener('change', () => { displayTotal(); });
  if(qtyEl) qtyEl.addEventListener('input', () => { displayTotal(); });
  if(spiralBox) spiralBox.addEventListener('change', () => { displayTotal(); });
  if(folderBox) folderBox.addEventListener('change', () => { displayTotal(); });
  if(deliveryBox) deliveryBox.addEventListener('change', () => { updateCollegeBlock(); displayTotal(); });
  if(collegeNameInput) collegeNameInput.addEventListener('input', () => { displayTotal(); });

  function openUrlFallback(url){
    try{
      const win = window.open(url, '_blank');
      if(!win) window.location.href = url;
    } catch(e){
      window.location.href = url;
    }
  }

  // build WA message and validate college if delivery requested
  if(waBtn) waBtn.addEventListener('click', (e) => {
    e.preventDefault();
    try{
      const t = calculate();
      if(t.violatesMinQty){
        alert(`Minimum ${t.minQtyRequired} pages required for the selected service.`);
        qtyEl.focus();
        return;
      }
      if(t.min === 0 && t.max === 0){
        alert('Please select a service.');
        return;
      }

      // delivery college validation
      let collegeTextDisplay = '';
      if(deliveryBox && deliveryBox.checked){
        const typed = (collegeNameInput && collegeNameInput.value) ? collegeNameInput.value.trim() : '';
        if(!typed){
          alert('Please type your college name for on-campus delivery.');
          collegeNameInput.focus();
          return;
        }
        collegeTextDisplay = typed;
      }

      const orderId = generateOrderId();
      const optText = (getSelectedOption() ? getSelectedOption().textContent.trim() : '—');
      const qty = (qtyEl ? (Number(qtyEl.value) || 1) : 1);
      const notes = (notesEl && notesEl.value) ? notesEl.value.trim() : 'None';
      const spiral = (spiralBox && spiralBox.checked) ? 'Yes' : 'No';
      const folder = (folderBox && folderBox.checked) ? 'Yes' : 'No';
      const deliveryChecked = (deliveryBox && deliveryBox.checked) ? 'Yes' : 'No';
      const deliveryStatusText = (t.freeDelivery && deliveryChecked) ? 'FREE' : (deliveryChecked ? `₹${t.deliveryFee}` : 'No');
      const totalText = (t.min === t.max) ? `₹${formatINR(t.min)}` : `₹${formatINR(t.min)} – ₹${formatINR(t.max)}`;

      const plainMsg = [
        `Order ID: ${orderId}`,
        'Hello Essentials Hub,',
        'I want to place an order:',
        `- Service: ${optText}`,
        `- Quantity/Pages/Hours: ${qty}`,
        `- Spiral Binding: ${spiral}`,
        `- File / Folder: ${folder}`,
        `- On-Campus Delivery (checkbox): ${deliveryChecked} (${deliveryStatusText})`,
        `- College: ${collegeTextDisplay || '—'}`,
        `- Notes: ${notes}`,
        `- Estimated Total: ${totalText}`,
        '',
        'Please confirm next steps.'
      ].join('\n');

      const encoded = encodeURIComponent(plainMsg);
      const phone = '918511367564';
      const url1 = `https://wa.me/${phone}?text=${encoded}`;
      const url2 = `https://api.whatsapp.com/send?phone=${phone}&text=${encoded}`;

      openUrlFallback(url1);
      setTimeout(()=>{ if(!location.href.includes('wa.me') && !location.href.includes('api.whatsapp.com')) openUrlFallback(url2); }, 900);
    } catch(err){
      console.error('WhatsApp send error', err);
      showError('Could not open WhatsApp. Try again or copy the order manually.');
    }
  });

  // invoice
  if(downloadBtn) downloadBtn.addEventListener('click', (e) => {
    e.preventDefault();
    try{
      const t = calculate();
      if(t.violatesMinQty){
        alert(`Minimum ${t.minQtyRequired} pages required for the selected service.`);
        qtyEl.focus();
        return;
      }
      if(t.min === 0 && t.max === 0){
        alert('Please select a service before downloading invoice.');
        return;
      }

      // delivery validation
      let collegeTextDisplay = '';
      if(deliveryBox && deliveryBox.checked){
        const typed = (collegeNameInput && collegeNameInput.value) ? collegeNameInput.value.trim() : '';
        if(!typed){
          alert('Please type your college name for on-campus delivery.');
          collegeNameInput.focus();
          return;
        }
        collegeTextDisplay = typed;
      }

      const orderId = generateOrderId();
      const optText = (getSelectedOption() ? getSelectedOption().textContent.trim() : '—');
      const qty = (qtyEl ? (Number(qtyEl.value) || 1) : 1);
      const notes = (notesEl && notesEl.value) ? notesEl.value.trim() : 'None';
      const spiral = (spiralBox && spiralBox.checked) ? 'Yes' : 'No';
      const folder = (folderBox && folderBox.checked) ? 'Yes' : 'No';
      const deliveryChecked = (deliveryBox && deliveryBox.checked) ? 'Yes' : 'No';
      const deliveryStatusText = (t.freeDelivery && deliveryChecked) ? 'FREE' : (deliveryChecked ? `₹${t.deliveryFee}` : '₹0');
      const totalText = (t.min === t.max) ? `₹${formatINR(t.min)}` : `₹${formatINR(t.min)} – ₹${formatINR(t.max)}`;

      const invoiceHtml = `
      <!doctype html><html><head><meta charset="utf-8"><title>Invoice - ${orderId}</title>
      <style>body{font-family:Arial;color:#111;background:#fff;padding:24px} .box{max-width:720px;margin:0 auto;border:1px solid #eee;padding:18px;border-radius:8px}
      h1{margin:0 0 6px;font-size:20px} .meta{color:#444;font-size:13px;margin-bottom:12px}
      table{width:100%;border-collapse:collapse;margin-top:12px} th,td{padding:10px;border-bottom:1px solid #eee;text-align:left}
      .total{font-weight:800;font-size:18px;text-align:right;padding-top:8px} .small{font-size:12px;color:#666;margin-top:8px} .center{ text-align:center; margin-top:16px; }
      @media print{ body{padding:0} .box{border:none} }</style></head><body>
      <div class="box"><h1>Essentials Hub — Invoice</h1>
      <div class="meta">Order ID: <strong>${orderId}</strong> &nbsp;&nbsp; Date: ${new Date().toLocaleString()}</div>
      <table><thead><tr><th>Item</th><th>Qty</th><th>Price</th></tr></thead>
      <tbody>
      <tr><td>${optText}</td><td>${qty}</td><td>${totalText}</td></tr>
      <tr><td>Spiral Binding</td><td>${spiral === 'Yes' ? 1 : 0}</td><td>${spiral === 'Yes' ? '₹20' : '₹0'}</td></tr>
      <tr><td>File / Folder</td><td>${folder === 'Yes' ? 1 : 0}</td><td>${folder === 'Yes' ? '₹30' : '₹0'}</td></tr>
      <tr><td>On-Campus Delivery</td><td>${deliveryChecked === 'Yes' ? 1 : 0}</td><td>${deliveryStatusText}</td></tr>
      </tbody></table>
      <div class="total">Estimated Total: <span>${totalText}</span></div>
      <div class="small">College: ${collegeTextDisplay || '—'}</div>
      <div class="small">Notes: ${notes}</div>
      <div class="center"><button onclick="window.print()">Print / Save PDF</button></div>
      </div></body></html>
      `;
      const w = window.open('', '_blank');
      w.document.write(invoiceHtml);
      w.document.close();
    } catch(err){
      console.error('Invoice error', err);
      showError('Could not create invoice. Try again.');
    }
  });

  // initial render
  updateExtrasAvailability();
  updateCollegeBlock();
  displayTotal();
})();
</script>
</body>
</html>
